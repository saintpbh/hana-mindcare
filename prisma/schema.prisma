generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Client {
  id                String   @id @default(uuid())
  name              String
  englishName       String?
  age               Int
  gender            String
  condition         String
  status            String   // 'stable', 'attention', 'crisis'
  lastSession       String
  nextSession       String
  sessionTime       String
  sessionType       String?  // 'in-person', 'online', 'phone'
  location          String?
  isSessionCanceled Boolean  @default(false)
  terminatedAt      DateTime? // Date when counseling was terminated
  tags              String[]
  notes             String
  contact           String
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  sessions          Session[]
  quickNotes        QuickNote[]
  
  counselorId       String?
  counselor         Counselor? @relation(fields: [counselorId], references: [id])
  
  moods             Mood[]
  prescriptions     Prescription[]
}

model Mood {
  id        String   @id @default(uuid())
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  score     Int      // 1: Bad, 2: Neutral, 3: Good
  note      String?
  createdAt DateTime @default(now())
}

model Prescription {
  id          String   @id @default(uuid())
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  title       String
  type        String   // 'video', 'article', 'audio'
  description String?
  contentUrl  String?
  createdAt   DateTime @default(now())
}

model Counselor {
  id                String   @id @default(uuid())
  name              String
  nickname          String?
  birthYear         String?
  gender            String?
  qualifications    String[] // e.g., ["Clinical Psychologist", "Art Therapist"]
  specialties       String[] // e.g., ["Anxiety", "Trauma"]
  residence         String?  // For distance check
  phoneNumber       String?
  
  clients           Client[]
  sessions          Session[]
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Session {
  id          String   @id @default(uuid())
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  
  counselorId String?
  counselor   Counselor? @relation(fields: [counselorId], references: [id])
  
  date        DateTime
  title       String   // e.g., "Initial Consultation", "CBT Session 1"
  type        String   @default("상담") // '상담', '검사', etc.
  duration    Int      @default(50) // minutes
  status      String   @default("Scheduled") // 'Scheduled', 'Completed', 'Canceled', 'NoShow'
  
  recurring   String?  // 'None', 'Weekly', 'BiWeekly', 'Monthly'
  
  // Analysis Fields (Optional for future appointments)
  summary     String?  @db.Text
  sentiment   String?   // 'Positive', 'Neutral', 'Negative'
  keywords    String[] // e.g., ["anxiety", "work", "sleep"]
  
  transcript  String?  @db.Text // Verbatim transcript
  notes       String?  @db.Text // Counselor's session notes
  counselingLog CounselingLog?
  
  meetingLink String?  // Zoom Meeting URL
  location    String?  // 'Zoom', 'Seoul Center', etc.

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CounselingLog {
  id          String   @id @default(uuid())
  sessionId   String   @unique
  session     Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  type        String   @default("SOAP") // 'SOAP', 'GENERAL'
  
  // SOAP Fields
  subjective  String?  @db.Text
  objective   String?  @db.Text
  assessment  String?  @db.Text
  plan        String?  @db.Text
  
  status      String   @default("DRAFT") // 'DRAFT', 'FINAL'
  writerName  String?
  signedAt    DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model QuickNote {
  id        String   @id @default(uuid())
  content   String   @db.Text
  clientId  String?
  client    Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  deletedAt DateTime? // For soft delete
}

model Location {
  id        String   @id @default(uuid())
  name      String   @unique
  createdAt DateTime @default(now())
}

model SystemSetting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
